(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const t of c.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&l(t)}).observe(document,{childList:!0,subtree:!0});function a(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(o){if(o.ep)return;o.ep=!0;const c=a(o);fetch(o.href,c)}})();const F=document.getElementById("debug-checkbox");F.onchange=function(){F.checked?(document.querySelector(".debug-container").hidden=!1,document.querySelector("#stack").hidden=!1):(document.querySelector(".debug-container").hidden=!0,document.querySelector("#stack").hidden=!0)};function I(e){document.getElementById("PC").innerHTML="0x"+(e.pc-2).toString(16),document.getElementById("I").innerHTML="0x"+e.i.toString(16),document.getElementById("DT").innerHTML="0x"+e.delay_timer,document.getElementById("SP").innerHTML="0x"+e.sp.toString(16),document.getElementById("OC").innerHTML="0x"+e.opcode.toString(16),document.getElementById("V0").innerHTML="0x"+e.v[0].toString(16),document.getElementById("V1").innerHTML="0x"+e.v[1].toString(16),document.getElementById("V2").innerHTML="0x"+e.v[2].toString(16),document.getElementById("V3").innerHTML="0x"+e.v[3].toString(16),document.getElementById("V4").innerHTML="0x"+e.v[4].toString(16),document.getElementById("V5").innerHTML="0x"+e.v[5].toString(16),document.getElementById("V6").innerHTML="0x"+e.v[6].toString(16),document.getElementById("V7").innerHTML="0x"+e.v[7].toString(16),document.getElementById("V8").innerHTML="0x"+e.v[8].toString(16),document.getElementById("V9").innerHTML="0x"+e.v[9].toString(16),document.getElementById("VA").innerHTML="0x"+e.v[10].toString(16),document.getElementById("VB").innerHTML="0x"+e.v[11].toString(16),document.getElementById("VC").innerHTML="0x"+e.v[12].toString(16),document.getElementById("VD").innerHTML="0x"+e.v[13].toString(16),document.getElementById("VE").innerHTML="0x"+e.v[14].toString(16),document.getElementById("VF").innerHTML="0x"+e.v[15].toString(16),document.getElementById("stack").innerHTML="Stack : "+e.stack}const A=10,m={r:23,g:14,b:22},v={r:219,g:146,b:75},y=document.getElementById("screen");let u=Math.floor(window.innerWidth/80);u>18&&(u=18);y.style.width=64*u+"px";y.style.height=32*u+"px";function C(e,r){const a=Math.ceil(e),l=Math.floor(r);return Math.floor(Math.random()*(l-a+1)+a)}let i={};const s={memory:[],stack:[],v:[],keys:{0:!1,1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1,8:!1,9:!1,a:!1,b:!1,c:!1,d:!1,e:!1,f:!1},i:0,pc:0,sp:0,gfx:[],scrn:[],ctx:null,beepSound:new Audio("/beep.wav"),delay_timer:0,sound_timer:0,opcode:0,font_set:[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],reset:function(){this.pc=512,this.sp=0,this.opcode=0,this.i=0,this.delay_timer=0,this.sound_timer=0;for(let e=0;e<16;e++)this.stack[e]=0;if(this.memory.length==0)for(let e=0;e<4096;e++)this.memory[e]=0;for(let e=0;e<16;e++)this.v[e]=0;this.gfx=new Array(64*32);for(let e=0;e<this.gfx.length;e++)this.gfx[e]=0;this.ctx=y.getContext("2d"),this.scrn=this.ctx.createImageData(64,32),this.update_scrn();for(let e=0;e<this.font_set.length;e++)this.memory[e]=this.font_set[e]},load:function(e){for(let r=0;r<e.length;r++)this.memory[r+512]=e[r]},update_scrn:function(){for(let e=0;e<this.gfx.length;e++){let r=e*4;this.scrn.data[r]=this.gfx[e]==1?v.r:m.r,this.scrn.data[r+1]=this.gfx[e]==1?v.g:m.g,this.scrn.data[r+2]=this.gfx[e]==1?v.b:m.b,this.scrn.data[r+3]=255}this.ctx.putImageData(this.scrn,0,0)},update_timers:function(){this.delay_timer>0&&this.delay_timer--,this.sound_timer>0&&(this.beepSound.play(),this.sound_timer--)},step:function(){this.opcode=this.memory[this.pc]<<8|this.memory[this.pc+1];let e=this.opcode;switch(e&61440){case 0:switch(e&15){case 0:this.gfx=new Array(64*32),this.update_scrn(),this.pc+=2;break;case 14:this.pc=this.stack[this.sp],this.stack[this.sp]=0,this.sp!=0&&this.sp--;break}break;case 4096:this.pc=e&4095;break;case 8192:this.pc+=2,this.stack[this.sp]!=0&&this.sp++,this.stack[this.sp]=this.pc,this.pc=e&4095;break;case 12288:var t=e>>8&15;this.v[t]==(e&255)?this.pc+=4:this.pc+=2;break;case 16384:var t=e>>8&15;this.v[t]!=(e&255)?this.pc+=4:this.pc+=2;break;case 20480:var t=e>>8&15,n=e>>4&15;this.v[t]==this.v[n]?this.pc+=4:this.pc+=2;break;case 24576:var t=e>>8&15,c=e&255;this.v[t]=c,this.pc+=2;break;case 28672:var t=(e&3840)>>8,c=e&255,r=this.v[t]+c;r>255&&(r-=256),this.v[t]=r,this.pc+=2;break;case 32768:switch(e&61455){case 32768:var t=e>>8&15,n=e>>4&15;this.v[t]=this.v[n],this.pc+=2;break;case 32769:var t=e>>8&15,n=e>>4&15;this.v[t]|=this.v[n],this.pc+=2;break;case 32770:var t=e>>8&15,n=e>>4&15;this.v[t]&=this.v[n],this.pc+=2;break;case 32771:var t=e>>8&15,n=e>>4&15;this.v[t]^=this.v[n],this.pc+=2;break;case 32772:var t=e>>8&15,n=e>>4&15,a=this.v[t]+this.v[n];a>255?this.v[15]=1:this.v[15]=0,this.v[t]=a&255,this.pc+=2;break;case 32773:var t=e>>8&15,n=e>>4&15;this.v[t]>=this.v[n]?this.v[15]=1:this.v[15]=0;var r=this.v[t]-this.v[n];r<0&&(r+=256),this.v[t]=r,this.pc+=2;break;case 32774:var t=e>>8&15,n=e>>4&15;this.v[15]=this.v[n]&1,this.v[t]>>>=1,this.pc+=2;break;case 32775:var t=e>>8&15,n=e>>4&15;this.v[n]>=this.v[t]?this.v[15]=1:this.v[15]=0;var r=this.v[n]-this.v[t];r<0&&(r+=256),this.v[t]=r,this.pc+=2;break;case 32782:var t=e>>8&15,n=e>>4&15;this.v[15]=this.v[n]>>7,this.v[t]<<=1,this.pc+=2;break}break;case 36864:var t=(e&3840)>>8,n=(e&240)>>4;this.v[t]!=this.v[n]?this.pc+=4:this.pc+=2;break;case 40960:this.i=e&4095,this.pc+=2;break;case 45056:var l=e&4095;this.pc=l+this.v[0];break;case 49152:var t=e>>8&15,o=C(0,255),c=e&255;this.v[t]=o&c,this.pc+=2;break;case 53248:var t=this.v[e>>8&15],n=this.v[e>>4&15],_=e&15;this.v[15]=0;for(let h=0;h<_;h++){let x=this.memory[this.i+h],b=(n+h)%32;for(let d=0;d<8;d++){let E=(t+d)%64;x&128>>d&&(this.gfx[E+b*64]==1&&(this.v[15]=1),this.gfx[E+b*64]^=1)}}this.update_scrn(),this.pc+=2;break;case 57344:switch(e&15){case 14:var t=e>>8&15;this.keys[this.v[t].toString(16)]==!0?this.pc+=4:this.pc+=2;break;case 1:var t=e>>8&15;this.keys[this.v[t].toString(16)]==!1?this.pc+=4:this.pc+=2;break}break;case 61440:switch(e&255){case 7:var t=e>>8&15;this.v[t]=this.delay_timer,this.pc+=2;break;case 10:break;case 21:var t=e>>8&15;this.delay_timer=this.v[t],this.pc+=2;break;case 24:var t=e>>8&15;this.sound_timer=this.v[t],this.pc+=2;break;case 30:var t=e>>8&15;this.i+=this.v[t],this.pc+=2;break;case 41:var t=e>>8&15;this.i=(this.v[t]&15)*5,this.pc+=2;break;case 51:var t=e>>8&15;this.memory[this.i]=Math.floor(this.v[t]/100),this.memory[this.i+1]=Math.floor(this.v[t]/10%10),this.memory[this.i+2]=Math.floor(this.v[t]%100%10),this.pc+=2;break;case 85:var t=e>>8&15;for(let x=0;x<t+1;x++)this.memory[this.i+x]=this.v[x];this.pc+=2;break;case 101:var t=e>>8&15;for(let x=0;x<t+1;x++)this.v[x]=this.memory[this.i+x];this.pc+=2;break}break;default:console.log("unimlmanted at opcode:"+this.opcode.toString(16));break}}};document.addEventListener("keydown",e=>{if((s.opcode&61455)==61450){var r=s.opcode>>8&15,a=-1;switch(e.key){case"1":a=1;break;case"2":a=2;break;case"3":a=3;break;case"4":a=12;break;case"q":a=4;break;case"w":a=5;break;case"e":a=6;break;case"r":a=13;break;case"a":a=7;break;case"s":a=8;break;case"d":a=9;break;case"f":a=14;break;case"z":a=10;break;case"x":a=0;break;case"c":a=11;break;case"v":a=15;break}a!=-1&&(s.v[r]=a,s.pc+=2)}else i[e.key]=!0,L()});document.addEventListener("keyup",e=>{i[e.key]=!1,L()});function L(){i[1]==!0?s.keys[1]=!0:i[1]==!1&&(s.keys[1]=!1),i[2]==!0?s.keys[2]=!0:i[2]==!1&&(s.keys[2]=!1),i[3]==!0?s.keys[3]=!0:i[3]==!1&&(s.keys[3]=!1),i[4]==!0?s.keys.c=!0:i[4]==!1&&(s.keys.c=!1),i.q==!0?s.keys[4]=!0:i.q==!1&&(s.keys[4]=!1),i.w==!0?s.keys[5]=!0:i.w==!1&&(s.keys[5]=!1),i.e==!0?s.keys[6]=!0:i.e==!1&&(s.keys[6]=!1),i.r==!0?s.keys.d=!0:i.r==!1&&(s.keys.d=!1),i.a==!0?s.keys[7]=!0:i.a==!1&&(s.keys[7]=!1),i.s==!0?s.keys[8]=!0:i.s==!1&&(s.keys[8]=!1),i.d==!0?s.keys[9]=!0:i.d==!1&&(s.keys[9]=!1),i.f==!0?s.keys.e=!0:i.f==!1&&(s.keys.e=!1),i.z==!0?s.keys.a=!0:i.z==!1&&(s.keys.a=!1),i.x==!0?s.keys[0]=!0:i.x==!1&&(s.keys[0]=!1),i.c==!0?s.keys.b=!0:i.c==!1&&(s.keys.b=!1),i.v==!0?s.keys.f=!0:i.v==!1&&(s.keys.f=!1)}let f=!1;const B=document.getElementById("screen"),g=document.getElementById("run"),R=document.getElementById("reset"),V=document.getElementById("step"),S=document.getElementById("rom-selecter"),p=document.getElementById("input-rom"),w=document.getElementById("drop-area");V.onclick=()=>{I(),console.log(s.opcode.toString(16)),s.step()};function k(){f=!f,f?g.innerHTML="Pause":g.innerHTML="Run"}g.onclick=k;R.onclick=()=>{s.reset()};addEventListener("resize",()=>{let e=Math.floor(window.innerWidth/80);e>18&&(e=18),B.style.width=64*e+"px",B.style.height=32*e+"px"});function M(e){switch(e){case"Tetris":return"W: Left, E: Right, Q:Rotate, A:Drop";case"Snake":return"W: Up, A: Left, S: Down, D: Right";case"Space Invaders":return"Q: Left, W: Shot/Start, E: Right";case"Brick":return"Q: Left, E: Right";case"Pong":return"1: Up, Q: Down";case"Cave":return"2: Up, S: Down, Q: Left, E: Right, V: Re/Start";case"Blinky":return"A: Left, S: Right, 3: Up, E: Down";default:return"?"}}async function D(e){S.innerHTML=e,document.getElementById("dropRomMenu").blur(),document.getElementById("controllerTooltip").setAttribute("data-tip",M(e));const a=await(await fetch("Chip8-Emulator/roms/"+e+".ch8")).arrayBuffer(),l=new Uint8Array(a);s.reset(),s.load(l),f==!1&&k()}window.loadRom=D;function T(){let e=p.files[0],r=new FileReader;r.readAsArrayBuffer(e),r.onload=a=>{const l=new Uint8Array(a.target.result);s.reset(),s.load(l)},document.getElementById("closeCustom").click(),S.innerHTML=e.name,document.getElementById("controllerTooltip").setAttribute("data-tip",M("Custom")),f==!1&&k()}p.addEventListener("change",T);w.addEventListener("dragover",e=>{e.preventDefault()});w.addEventListener("drop",e=>{e.preventDefault(),p.files=e.dataTransfer.files,T()});function P(){document.getElementById("rom-modal").showModal()}function H(){if(requestAnimationFrame(H),f==!0){for(let e=0;e<A;e++)s.step(),F.checked&&I(s);s.update_timers()}}window.showCustom=P;H();
